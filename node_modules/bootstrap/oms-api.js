/**
 * Load modules
 */

// Built-in
var fs = require('fs');
// Global
var config = require('config');
var db = require('db');
var logger = require('logger');



/**
 * Variables
 */

var configDao = new db.Dao('config');



/**
 * Initialise the CA files, add the certificate and
 * the private key.
 */
var initCa = function (callback) {
	// Get CA files
	configDao.findOne({name: 'certificationAuthority'}, function (ca) {
		var tmpDir = config.get('serviceTmpDir');
		fs.writeFileSync(tmpDir + ca.certificate.filename, ca.certificate.contents);
		fs.writeFileSync(tmpDir + ca.private_key.filename, ca.private_key.contents);
		logger.info('[Bootstrap] Ca files added')
		if (callback) callback(null);
	});
};



/**
 * Exports
 */

// Variables
exports.before = 	[
					];
exports.tasks = 	[
						initCa
					];
exports.after = 	[
					];